<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Portal | GEOID STUDY CENTRE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-deep: #1a2a6c;
            --accent-gold: #fdbb2d;
            --sidebar-bg: #ffffff;
            --text-dark: #2d3436;
            --grid-color: #2980b9;
            --shadow-static: 2px 2px 5px rgba(0,0,0,0.1);
        }

        body { margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; background-color: #e9ecef; }
        .banner-container { width: 100%; background: white; text-align: center; border-bottom: 3px solid var(--primary-deep); }
        .banner-container img { max-width: 550px; width: 100%; height: auto; }
        
        .portal-main { display: flex; min-height: calc(100vh - 110px); }
        .sidebar { width: 240px; background: var(--sidebar-bg); border-right: 1px solid #ddd; }
        .profile-area { padding: 25px 10px; text-align: center; border-bottom: 1px solid #eee; }
        .profile-area img { width: 85px; height: 95px; border: 2px solid var(--primary-deep); object-fit: cover; border-radius: 4px; }
        .profile-area h4 { margin: 12px 0 5px; color: var(--primary-deep); font-size: 14px; text-transform: uppercase; }
        
        .menu-label { background: var(--primary-deep); color: white; padding: 8px 15px; font-size: 11px; font-weight: bold; margin-top: 5px; }
        .nav-list { list-style: none; padding: 0; margin: 0; }
        .nav-list li { padding: 12px 15px; border-bottom: 1px solid #f0f0f0; font-size: 12.5px; color: var(--text-dark); cursor: pointer; display: flex; align-items: center; gap: 10px; }
        .nav-list li:hover { background: #f1f1f1; color: var(--primary-deep); }

        .content-area { flex: 1; padding: 30px; background-color: #f1f3f5; }
        .grid-container { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; max-width: 1100px; margin: 0 auto; }
        
        .grid-box { 
            background: var(--grid-color); color: white; text-decoration: none; 
            padding: 15px 10px; border-radius: 8px; text-align: center; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            gap: 8px; font-weight: bold; font-size: 10px; height: 90px; 
            box-shadow: var(--shadow-static); cursor: pointer; transition: none;
        }
        .grid-box:hover { filter: brightness(0.9); }
        .grid-box i { font-size: 20px; color: var(--accent-gold); }

        .content-viewer { background: white; padding: 20px; border-radius: 8px; box-shadow: var(--shadow-static); min-height: 400px; }
        .back-btn { margin-bottom: 15px; cursor: pointer; padding: 8px 15px; background: var(--primary-deep); color: white; border: none; border-radius: 4px; font-size: 11px; font-weight: bold; }

        .auth-card { max-width: 400px; margin: 50px auto; background: white; padding: 35px; border-radius: 12px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); text-align: center; }
        .form-input { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        .btn-submit { background: var(--primary-deep); color: white; border: none; width: 100%; padding: 12px; font-weight: bold; border-radius: 4px; cursor: pointer; margin-top: 10px; }

        footer { padding: 15px; text-align: center; background: white; font-size: 11px; color: #777; border-top: 1px solid #ddd; }
        .hidden { display: none !important; }

        /* --- Updated Mobile Responsive Styles --- */
        @media (max-width: 900px) { 
            .portal-main { flex-direction: column; } /* মোবাইলে সাইডবার উপরে আসবে */
            .sidebar { 
                width: 100%; 
                border-right: none; 
                border-bottom: 2px solid #ddd;
            }
            .grid-container { 
                grid-template-columns: repeat(2, 1fr); 
                padding: 10px;
            } 
            .content-area {
                padding: 15px;
            }
            .profile-area {
                display: flex;
                align-items: center;
                gap: 15px;
                text-align: left;
                padding: 15px;
            }
            .profile-area img {
                width: 60px;
                height: 70px;
            }
            .nav-list {
                display: flex;
                flex-wrap: wrap;
                background: #f8f9fa;
            }
            .nav-list li {
                flex: 1 1 45%; /* মেনু আইটেমগুলো দুই কলামে দেখাবে */
                border: 1px solid #eee;
            }
        }
    </style>
</head>
<body oncontextmenu="return false;">

<div class="banner-container">
    <img src="https://ik.imagekit.io/8v5m0fw9z/Blue%20and%20White%20Modern%20Coming%20Soon%20Email%20Header.png" alt="GEOID Banner">
</div>

<div id="auth-section">
    <div id="login-view" class="auth-card">
        <h3 style="color:var(--primary-deep);">STUDENT LOGIN</h3>
        <form id="login-form">
            <input type="email" id="login-email" class="form-input" placeholder="Email Address" required>
            <input type="password" id="login-password" class="form-input" placeholder="Password" required>
            <button type="submit" class="btn-submit">LOGIN</button>
        </form>
        <p style="font-size:12px; margin-top:15px;">New User? <a href="#" onclick="toggleAuth()" style="color:red; font-weight:bold;">Register Here</a></p>
    </div>
    <div id="signup-view" class="auth-card hidden">
        <h3 style="color:var(--primary-deep);">REGISTRATION</h3>
        <form id="signup-form">
            <input type="text" id="signup-name" class="form-input" placeholder="Full Name" required>
            <input type="email" id="signup-email" class="form-input" placeholder="Email Address" required>
            <input type="password" id="signup-password" class="form-input" placeholder="Password" required>
            <input type="file" id="signup-photo" class="form-input" accept="image/*">
            <button type="submit" class="btn-submit">CREATE ACCOUNT</button>
        </form>
        <p><a href="#" onclick="toggleAuth()" style="font-weight:bold; color:var(--grid-color); font-size:12px;">Back to Login</a></p>
    </div>
</div>

<div id="dashboard-view" class="hidden portal-main">
    <div class="sidebar">
        <div class="profile-area">
            <img id="d-photo" src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png">
            <h4 id="d-name">STUDENT NAME</h4>
        </div>
        
        <div class="menu-label">Navigation</div>
        <ul class="nav-list">
            <li onclick="closeFeature()"><i class="fas fa-home"></i> Home</li>
            <li onclick="openFeature('MY COURSES', 'courses')"><i class="fas fa-graduation-cap"></i> My Courses</li>
            <li onclick="openFeature('ATTENDANCE', 'attendance')"><i class="fas fa-calendar-check"></i> Attendance</li>
            <li onclick="openFeature('CLASS ROUTINE', 'routine')"><i class="fas fa-clock"></i> Class Routine</li>
        </ul>

        <div class="menu-label">Settings & Support</div>
        <ul class="nav-list">
            <li onclick="openFeature('EDIT PROFILE', 'profile_edit')"><i class="fas fa-user-edit"></i> Edit Profile</li>
            <li onclick="logout()" style="color:red; font-weight:bold;"><i class="fas fa-sign-out-alt"></i> Logout</li>
        </ul>
    </div>

    <div class="content-area">
        <div id="main-grid" class="grid-container">
            <div onclick="openFeature('DAILY TUTORIAL', 'tutorial')" class="grid-box"><i class="fas fa-book-open"></i><span>DAILY TUTORIAL</span></div>
            <div onclick="openFeature('QUESTION BANK', 'qbank')" class="grid-box"><i class="fas fa-layer-group"></i><span>QUESTION BANK</span></div>
            <div onclick="openFeature('MCQ PRACTICE', 'mcq')" class="grid-box"><i class="fas fa-pencil-alt"></i><span>MCQ PRACTICE</span></div>
            <div onclick="openFeature('WEEKLY TEST', 'test')" class="grid-box"><i class="fas fa-file-alt"></i><span>WEEKLY TEST</span></div>
            <div onclick="openFeature('ASSIGNMENT', 'assignment')" class="grid-box"><i class="fas fa-tasks"></i><span>ASSIGNMENT</span></div>
            <div onclick="openFeature('NOTICE', 'notice')" class="grid-box"><i class="fas fa-bullhorn"></i><span>NOTICE</span></div>
            <div onclick="openFeature('FEES', 'fees')" class="grid-box"><i class="fas fa-rupee-sign"></i><span>FEES</span></div>
            <div onclick="openFeature('RESULT', 'result')" class="grid-box"><i class="fas fa-chart-line"></i><span>RESULT</span></div>
        </div>

        <div id="inner-view" class="hidden">
            <button class="back-btn" onclick="closeFeature()"><i class="fas fa-arrow-left"></i> BACK TO DASHBOARD</button>
            <div class="content-viewer">
                <h3 id="view-title" style="color:var(--primary-deep); margin-top:0;">Section</h3>
                <hr>
                <div id="view-body" style="padding:15px 0;"></div>
            </div>
        </div>
    </div>
</div>

<footer>
    © 2026 GEOID Study Centre | Developed by <span style="color:var(--primary-deep); font-weight:bold;">Subhadip Cyber Technology</span>
</footer>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
    const supabaseUrl = "https://evtzqxwvagfhqpdyhtve.supabase.co";
    const supabaseKey = "sb_publishable__5NpFltPQhyoSRu7hfHCzQ_FnCsa5rr";
    const sb = supabase.createClient(supabaseUrl, supabaseKey);
    let userEmail = "";

    function toggleAuth(){
        document.getElementById("login-view").classList.toggle("hidden");
        document.getElementById("signup-view").classList.toggle("hidden");
    }

    async function showDashboard(user) {
        userEmail = user.email;
        document.getElementById("auth-section").classList.add("hidden");
        document.getElementById("dashboard-view").classList.remove("hidden");
        const { data: profile } = await sb.from('profiles').select('full_name, avatar_url').eq('id', user.id).single();
        if (profile) {
            document.getElementById("d-name").innerText = profile.full_name;
            if (profile.avatar_url) document.getElementById("d-photo").src = profile.avatar_url;
        }
    }

    async function openFeature(title, type) {
        document.getElementById("main-grid").classList.add("hidden");
        document.getElementById("inner-view").classList.remove("hidden");
        document.getElementById("view-title").innerText = title;
        const body = document.getElementById("view-body");
        body.innerHTML = "<p>Loading...</p>";

        const { data, error } = await sb.from('student_contents')
            .select('*')
            .eq('student_email', userEmail)
            .ilike('content_type', type);

        if (data && data.length > 0) {
            let html = "";
            data.forEach(item => {
                html += `<div style="border:1px solid #ddd; padding:12px; border-radius:6px; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center; background:#fafafa;">
                    <div><b>${item.title}</b><br><small style="color:gray;">${new Date(item.created_at).toLocaleDateString()}</small></div>
                    <a href="${item.file_url}" target="_blank" style="background:#2ecc71; color:white; padding:6px 15px; text-decoration:none; border-radius:4px; font-size:12px; font-weight:bold;">OPEN FILE</a>
                </div>`;
            });
            body.innerHTML = html;
        } else {
            body.innerHTML = `<p style="text-align:center; color:gray; padding-top:40px;">No data found for ${title}.</p>`;
        }
    }

    function closeFeature() {
        document.getElementById("inner-view").classList.add("hidden");
        document.getElementById("main-grid").classList.remove("hidden");
    }

    (async () => {
        const { data: { user } } = await sb.auth.getUser();
        if (user) showDashboard(user);
    })();

    document.getElementById("login-form").addEventListener("submit", async e => {
        e.preventDefault();
        const { data, error } = await sb.auth.signInWithPassword({
            email: document.getElementById("login-email").value,
            password: document.getElementById("login-password").value
        });
        if (error) alert(error.message); else showDashboard(data.user);
    });

    document.getElementById("signup-form").addEventListener("submit", async e => {
        e.preventDefault();
        const email = document.getElementById("signup-email").value;
        const password = document.getElementById("signup-password").value;
        const name = document.getElementById("signup-name").value;
        const photo = document.getElementById("signup-photo").files[0];
        const { data: auth, error } = await sb.auth.signUp({ email, password });
        if (error) return alert(error.message);
        let url = "";
        if (photo && auth.user) {
            const path = `avatar_${auth.user.id}`;
            await sb.storage.from('avatars').upload(path, photo);
            url = sb.storage.from('avatars').getPublicUrl(path).data.publicUrl;
        }
        await sb.from('profiles').insert([{ id: auth.user.id, full_name: name, email: email, avatar_url: url }]);
        alert("Account Created! Please Login.");
        location.reload();
    });

    async function logout() { await sb.auth.signOut(); location.reload(); }
</script>
</body>
</html>
